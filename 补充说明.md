# FlareDrive-R2 功能补充说明

## 🎯 新增功能

### 1. 媒体预览功能
- **图片预览**: 支持缩放、旋转、拖拽等操作
- **视频预览**: 支持自动播放和控制
- **键盘快捷键**: 
  - `ESC`: 关闭预览
  - `←/→`: 切换上一个/下一个媒体
  - `+/-`: 放大/缩小
  - `R`: 旋转图片
  - `0`: 重置图片状态
- **触摸支持**: 移动端支持双指缩放和单指拖拽

### 2. 分享功能
- **桌面端**: 生成二维码分享
- **移动端**: 原生分享选项
- **复制链接**: 一键复制文件链接

## ⚙️ 环境变量配置

### 二维码API配置

为了在Cloudflare Pages中支持二维码生成，需要配置外部二维码API：

#### 1. 在Cloudflare Pages中设置环境变量

进入你的Cloudflare Pages项目设置页面：

1. 点击 **Settings** → **Environment variables**
2. 添加新的环境变量：
   - **Variable name**: `QRCODE_API`
   - **Value**: 二维码API地址

#### 2. 推荐的二维码API服务

**选项1: QR Server (免费)**
```
QRCODE_API=https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=
```

**选项2: QRCode API (免费)**
```
QRCODE_API=https://qrcodeapi.com/api?data=
```

**选项3: QuickChart (免费)**
```
QRCODE_API=https://quickchart.io/qr?text=
```

**注意**: 配置的API URL应该包含完整的参数，系统会自动在末尾追加编码后的分享链接。

#### 3. 配置示例

在Cloudflare Pages环境变量中设置：
```
QRCODE_API = https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=
```

**重要**: 确保API URL以 `data=` 或 `text=` 等参数结尾，系统会自动追加编码后的链接。

#### 4. 验证配置

配置完成后：
1. 重新部署项目
2. 打开任意图片或视频的预览
3. 点击分享按钮
4. 在桌面端应该能看到生成的二维码

## 🔧 功能修复

### 图片旋转优化

- **修复前**: 图片旋转到360度后会反向旋转
- **修复后**: 图片可以连续旋转，不会反向

### 权限系统增强

- **只读权限**: 支持环境变量格式 `username:password:r=directory1/,directory2/`
- **游客访问**: 未授权用户看到登录提示而非空白页面
- **权限继承**: 已登录用户可以访问游客目录

## 📱 移动端优化

- **响应式设计**: 自适应桌面和移动端界面
- **触摸操作**: 支持双指缩放、单指拖拽
- **原生分享**: 移动端使用系统原生分享功能

## 🚀 部署注意事项

1. **环境变量**: 配置完环境变量后需要重新部署
2. **缓存**: 配置API有5分钟缓存，修改后可能需要等待
3. **CORS**: 确保选择的二维码API支持跨域请求

## 🐛 故障排除

### 二维码不显示
1. 检查环境变量 `QRCODE_API` 是否正确配置
2. 确认API地址可以正常访问
3. 查看浏览器控制台是否有错误信息

### 图片预览问题
1. 确认图片URL可以正常访问
2. 检查图片格式是否支持（jpg, png, gif, webp等）
3. 查看网络连接是否正常

### 移动端操作问题
1. 确认使用支持触摸的设备
2. 检查浏览器是否支持触摸事件
3. 尝试刷新页面重新加载

---

**注意**: 这些功能是在原项目基础上的增强，保持了原有的所有功能和兼容性。
